<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RHKIC Student Dashboard</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to bottom right, #D32F2F, #FBC02D, #6D4C41);
    color: white;
    padding: 20px;
  }
  h1 { text-align: center; }
  button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background: #FBC02D;
    color: black;
    font-weight: bold;
    margin-bottom: 20px;
  }
  button:hover { background: #FFD600; }
  .notice-board, .homework-board {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
    backdrop-filter: blur(5px);
    margin-top: 20px;
  }
  ul { list-style: none; padding-left: 0; }
  li { padding: 5px 0; border-bottom: 1px solid white; }
</style>
</head>
<body>
  <!-- Top header with logo -->
  <div style="display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:12px;">
    <a href="index.html" style="display:inline-block;">
      <img src="logooooo.png" alt="RHKIC Logo" style="width:64px;height:64px;border-radius:8px;object-fit:cover;">
    </a>
    <div style="font-weight:700;font-size:18px;color:#fff;">RHKIC BANDIYA</div>
  </div>

<h1>üë®‚Äçüéì Student Dashboard</h1>
<div style="display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:10px;">
  <a href="index.html" style="color:yellow;font-weight:bold;text-decoration:none;">Home</a>
  <button onclick="logout()">Logout</button>
</div>

<!-- Two-column layout: left = content, right = student profile -->
<div style="display:flex;gap:20px;align-items:flex-start;">
  <div style="flex:1;">
    <div class="homework-board">
      <h2>üìö Homework</h2>
      <ul id="homeworkList"></ul>
    </div>

    <div class="notice-board">
      <h2>üì¢ Notices</h2>
      <ul id="noticeList"></ul>
    </div>
  </div>

  <div id="studentProfile" style="width:280px;">
    <!-- Profile will be injected here -->
    <div style="background: rgba(255,255,255,0.06); padding:12px; border-radius:10px;">
      <h3 style="margin-top:0;">Student Profile</h3>
      <p style="opacity:0.9;">Loading...</p>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCIjL0gWAAe-kd1jcbqZeWqSbHj4Yi9jDI",
  authDomain: "rhkic-bandiya.firebaseapp.com",
  databaseURL: "https://rhkic-bandiya-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rhkic-bandiya",
  storageBucket: "rhkic-bandiya.firebasestorage.app",
  messagingSenderId: "1050448660999",
  appId: "1:1050448660999:web:111aade54c5392df6a78a2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// ‚úÖ Check login & role
onAuthStateChanged(auth, async (user) => {
  if(!user) window.location.href = "auth.html";

  const uid = user.uid;
  const snapshot = await get(ref(db, "users/" + uid));
  if(snapshot.exists()){
    const role = snapshot.val().role;
    if(role !== "student"){
      alert("Access denied! Only students can view this page.");
      window.location.href = "index.html";
    }
    // render profile panel with student data if present
    renderProfile(snapshot.val());
  } else {
    alert("No user data found!");
    window.location.href = "auth.html";
  }

  // Load notices and homework
  loadNotices();
  loadHomework();
});

// Logout
window.logout = () => {
  signOut(auth).then(() => window.location.href = "index.html");
};

// Load notices from Firebase
async function loadNotices(){
  const snapshot = await get(ref(db, "notices/"));
  const list = document.getElementById("noticeList");
  list.innerHTML = "";
  if(snapshot.exists()){
    const notices = snapshot.val();
    Object.values(notices).forEach(n => {
      const li = document.createElement("li");
      li.innerText = n.text;
      list.appendChild(li);
    });
  }
}

// Render student profile on the right column
function renderProfile(userRecord){
  const container = document.getElementById('studentProfile');
  if(!container) return;
  const student = userRecord.student || {};
  const email = userRecord.email || '';
  const html = `
    <div style="background: rgba(255,255,255,0.06); padding:12px; border-radius:10px;">
      <h3 style="margin-top:0;">${student.fullName || 'Student'}</h3>
      <p style="font-size:13px;opacity:0.9;margin:6px 0;">${email}</p>
      <p style="margin:6px 0;"><strong>Class:</strong> ${student.class || ''}</p>
      <p style="margin:6px 0;"><strong>Father:</strong> ${student.fatherName || ''}</p>
      <p style="margin:6px 0;"><strong>Mother:</strong> ${student.motherName || ''}</p>
      <p style="margin:6px 0;"><strong>Mobile:</strong> ${student.mobile || ''}</p>
      <p style="margin:6px 0;"><strong>WhatsApp:</strong> ${student.whatsapp || ''}</p>
      <p style="margin-top:10px;font-size:12px;opacity:0.8">Address:<br>${student.address || ''}</p>
    </div>
  `;
  container.innerHTML = html;
}

// Load homework from Firebase
async function loadHomework(){
  const snapshot = await get(ref(db, "homework/"));
  const list = document.getElementById("homeworkList");
  list.innerHTML = "";
  if(snapshot.exists()){
    const homework = snapshot.val();
    Object.values(homework).forEach(hw => {
      const li = document.createElement("li");
      li.innerText = hw.text + " (Class: " + hw.class + ")";
      list.appendChild(li);
    });
  }
}
</script>

</body>
</html>